(function(){define("JW/util/util",["base"],function(){return{isDefined:function(a){return a!==undefined&&a!==null}}})})(),function(){var a={};define("JW/cache/cache",["JW/util/util"],function(b){var c=3e4,d=function(a){return Date.now()-a<=c},e=function(c){var e=a[c.str],f;return b.isDefined(e)&&d(e.timestamp)?(console.log("Cache hit"),f=e.patient):(console.log("Cache miss"),f="Cache miss"),f},f=function(b){a[b.personnummer.str]={patient:b,timestamp:Date.now()}};return{getPatient:function(a){return e(a)},putPatient:function(a){f(a)}}})}(),function(){define("JW/personnummer/Personnummer",["base","JW/util/util"],function(a,b){return function(a){var c=/[0-9]+/,d=new Date(1880,0,1),e=function(a){return b.isDefined(a)&&typeof a=="string"&&a.length===12&&c.test(a)?!0:!1};if(e(a))this.str=a;else throw new Error("Incorrect personnummer "+a)}})}(),function(){define("JW/patient/Patient",["JW/personnummer/Personnummer"],function(a){return function(b,c){if(b instanceof a)this.personnummer=b,this.medications=c;else throw new Error("Not a correct personnummer")}})}(),function(){define("JW/proxy/proxy",["JW/util/util","JW/cache/cache","JW/personnummer/Personnummer","JW/patient/Patient","jquery"],function(a,b,c,d){return{getPatient:function(e,f,g){var h,i=a.isDefined(g)&&a.isDefined(g.url)?g.url:"ws/patient/",j=function(a){return new d(new c(a.personnummer.personnummerStr),a.medications)};a.isDefined(e)&&e instanceof c?(h=b.getPatient(e),h==="Cache miss"?$.ajax({url:i+e.str,success:function(a){var c;a.status==="false"?f({errorMessage:"There's no patient with that personnummer"}):(c=j(a),b.putPatient(c),f({patient:c}))},failure:function(){f({errorMessage:"Something went wrong in the communication with the server system."})}}):f({patient:h})):f({errorMessage:"Erroneous personnumer"})}}})}(),function(){require(["JW/util/util","JW/proxy/proxy","JW/personnummer/Personnummer","JW/patient/Patient","jquery","jquery-encoder"],function(a,b,c,d){var e=function(a){var b=a.str.substring(0,8),c=a.str.substring(8);return $.encoder.encodeForHTML(b+"-"+c)},f=function(a){var b,c="",d=function(a){switch(a){case"GRAM":return"g";case"MILLIGRAM":return"mg";case"MILLILITER":return"ml";default:throw new Error("Unknown unit "+a)}};for(b=0;b<a.length;b++)c+=$.encoder.encodeForHTML(a[b].name)+(a[b].name.length>8?"\t":"\t\t\t"),c+=$.encoder.encodeForHTML(a[b].amount)+((a[b].amount+"").length>4?"\t":"\t\t"),c+=$.encoder.encodeForHTML(d(a[b].unit))+"\t",c+="\r";return c},g=function(a){$("#patientInfo").html(e(a.personnummer)),$("#medicationList").html(f(a.medications))},h=function(a){alert(a)},i=function(e){var f=$("#searchField").val(),i;console.log("Search for: "+f);if(!a.isDefined(f)||f==="")h("You have to enter a Swedish personnummer");else try{i=new c(f),b.getPatient(i,function(b){a.isDefined(b.errorMessage)?h(b.errorMessage):a.isDefined(b.patient)&&b.patient instanceof d&&g(b.patient)})}catch(j){h(j)}};$(document).ready(function(){$("#searchButton").click(function(a){i(a)}),$("#searchField").keypress(function(a){a.which===13&&i(a)})})})}(),define("JW/gui/gui",function(){}),function(){requirejs.config({paths:{jquery:"lib/jquery-1.7.1.min","jquery-encoder":"lib/jquery-encoder-0.1.0"}}),require(["jquery","JW/util/util","JW/gui/gui"],function(a){console.log("App initialized")})}(),define("base",function(){})